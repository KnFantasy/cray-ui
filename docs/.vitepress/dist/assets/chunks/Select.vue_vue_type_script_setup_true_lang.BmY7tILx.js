import{d as E,h,l as m,i as W,y as A,o as d,c as u,b as c,w as b,F as K,u as U,n as y,B as q,a as z,G,L as j,M as J}from"./framework.BX0NulVQ.js";import{d as P,_ as Q}from"./Tooltip.vue_vue_type_script_setup_true_lang.Bxxc8BbV.js";import{_ as T}from"./Input.vue_vue_type_script_setup_true_lang.B4p964v3.js";import{_ as O,i as x}from"./Icon.vue_vue_type_script_setup_true_lang.B56VepCh.js";import{R as X}from"./RenderVnode.vue_vue_type_script_lang.5MruYBe8.js";const Y={key:0,class:"cray-select__loading"},Z={key:1,class:"cray-select__no-data"},ee={key:2,class:"cray-select__menu"},le=["id","onClick","onMouseover"],se=E({name:"CraySelect",__name:"Select",props:{modelValue:{},options:{default:()=>[]},placeholder:{},disabled:{type:Boolean},clearable:{type:Boolean},renderLabel:{},filterable:{type:Boolean},filterMethod:{},remote:{type:Boolean},remoteMethod:{}},emits:["change","update:modelValue","visible-change","clear"],setup(k,{emit:M}){const a=k,p=M,f=h(),g=h(),C=m(()=>a.remote?500:0),_=l=>{const t=a.options.find(i=>i.value===l);return t||null},v=_(a.modelValue),n=h(a.options);W(()=>a.modelValue,l=>{const t=_(l);e.inputValue=t?t.label:"",e.selectedOption=t});const w=async l=>{if(a.filterable)if(a.filterMethod&&x(a.filterMethod))n.value=a.filterMethod(l);else if(a.remote&&a.remoteMethod&&x(a.remoteMethod)){e.loading=!0;try{n.value=await a.remoteMethod(l)}catch(t){console.error(t),n.value=[]}finally{e.loading=!1}}else n.value=a.options.filter(t=>t.label.includes(l))},e=A({inputValue:v?v.label:"",selectedOption:v,mouseHover:!1,loading:!1,highlightIndex:-1}),o=h(!1),$=m(()=>a.clearable&&e.mouseHover&&e.selectedOption&&e.inputValue!==""),B=[{name:"offset",options:{offset:[0,8]}},{name:"sameWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:l})=>{l.styles.popper.width=`${l.rects.reference.width}px`},effect:({state:l})=>{l.elements.popper.style.width=`${l.elements.reference.offsetWidth}px`}}],s=l=>{l?(e.highlightIndex=e.selectedOption?a.options.indexOf(J(e.selectedOption)):-1,a.filterable&&e.selectedOption&&(e.inputValue=""),a.filterable&&w(e.inputValue),f.value.show()):(f.value.hide(),a.filterable&&(e.inputValue=e.selectedOption?e.selectedOption.label:"")),o.value=l,p("visible-change",l)},R=m(()=>a.filterable&&e.selectedOption&&o.value?e.selectedOption.label:a.placeholder),D=()=>{a.disabled||(o.value?s(!1):s(!0))},I=l=>{l.disabled||(e.inputValue=l.label,e.selectedOption=l,p("change",l.value),p("update:modelValue",l.value),s(!1),g.value.ref.focus())},S=P(()=>{w(e.inputValue)},C.value),L=l=>{switch(l.key){case"Enter":o.value?e.highlightIndex>-1&&n.value[e.highlightIndex]?I(n.value[e.highlightIndex]):s(!1):s(!0);break;case"Escape":o.value&&s(!1);break;case"ArrowUp":if(l.preventDefault(),n.value.length>0){e.highlightIndex===-1&&(e.highlightIndex=0);let t=0;do t++,e.highlightIndex--,e.highlightIndex===-1&&(e.highlightIndex=n.value.length-1);while(n.value[e.highlightIndex].disabled&&t<n.value.length)}break;case"ArrowDown":if(l.preventDefault(),n.value.length>0){e.highlightIndex===-1&&(e.highlightIndex=-1);let t=0;do t++,e.highlightIndex++,e.highlightIndex===n.value.length&&(e.highlightIndex=0);while(n.value[e.highlightIndex].disabled&&t<n.value.length)}}},F=()=>{e.inputValue="",e.selectedOption=null,e.highlightIndex=-1},H=(l,t)=>{l.disabled||(e.highlightIndex=t)};return(l,t)=>(d(),u("div",{class:y(["cray-select",{"is-disabled":l.disabled}]),onClick:D},[c(Q,{placement:"bottom-start",ref_key:"tooltipRef",ref:f,manual:"",modifiers:B,onClickOutside:t[3]||(t[3]=i=>s(!1))},{content:b(()=>[e.loading?(d(),u("div",Y,[c(O,{icon:"spinner",spin:""})])):l.filterable&&n.value.length===0?(d(),u("div",Z," no matching data ")):(d(),u("ul",ee,[(d(!0),u(K,null,U(n.value,(i,r)=>{var V;return d(),u("li",{key:r,class:y(["cray-select__menu-item",{"is-disabled":i.disabled,"is-selected":((V=e.selectedOption)==null?void 0:V.value)===i.value,"is-highlighted":e.highlightIndex===r}]),id:`select-item-${i.value}`,onClick:q(N=>I(i),["stop"]),onMouseover:N=>H(i,r)},[c(X,{vNode:l.renderLabel?l.renderLabel(i):i.label},null,8,["vNode"])],42,le)}),128))]))]),default:b(()=>{var i;return[z("div",{class:"cray-select__input-wrapper",onMouseenter:t[1]||(t[1]=r=>e.mouseHover=!0),onMouseleave:t[2]||(t[2]=r=>e.mouseHover=!1)},[c(T,{modelValue:e.inputValue,"onUpdate:modelValue":t[0]||(t[0]=r=>e.inputValue=r),disabled:l.disabled,placeholder:R.value,ref_key:"inputRef",ref:g,readonly:!l.filterable||!o.value,onInput:G(S),onKeydown:L,onClear:F,clearable:!!$.value},j({_:2},[(i=g.value)!=null&&i.showClear?void 0:{name:"suffix",fn:b(()=>[c(O,{icon:"angle-down",class:y(["header-angle",{"is-active":o.value}])},null,8,["class"])]),key:"0"}]),1032,["modelValue","disabled","placeholder","readonly","onInput","clearable"])],32)]}),_:1},512)],2))}});export{se as _};
